<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kakao Map Example</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=204a7c5835adfe98d1f80dbb2054fab3&libraries=services,clusterer,drawing"></script>
</head>

<body>
    <div id="map" style="width:100%;height:400px;"></div>
    <input type="text" id="searchInput" placeholder="장소를 검색하세요">
    <button onclick="searchPlace()">검색</button>
    <ul id="placeListView"></ul>

    <script>
        let customMarkers = [];

        function initMap() {
            let map;
            const placeListView = document.getElementById('placeListView');

            const container = document.getElementById('map');
            const options = {
                center: new kakao.maps.LatLng(37.5665, 126.9780),
                level: 13
            };

            map = new kakao.maps.Map(container, options);

            // 사용자가 직접 입력한 장소 목록
            const locations = [
                { name: '티스테이션 도림점', address: '서울 영등포구 도림로 342' },
                { name: '장소2', address: '주소2' },
                // 추가적으로 필요한 만큼 계속 추가
            ];

            locations.forEach(location => {
                const address = location.address;
                const name = location.name;

                // 주소로부터 좌표 얻어오기
                const geocoder = new kakao.maps.services.Geocoder();
                geocoder.addressSearch(address, (result, status) => {
                    if (status === kakao.maps.services.Status.OK) {
                        const customCoords = new kakao.maps.LatLng(result[0].y, result[0].x);
                        const customMarker = new kakao.maps.Marker({
                            position: customCoords,
                            map: map,
                        });

                        // 사용자가 부여한 이름 추가
                        customMarker.name = name;

                        customMarkers.push(customMarker);
                        updatePlaceList();
                    }
                });
            });

            const input = document.getElementById('searchInput');

            window.searchPlace = function () {
                const keyword = input.value;
                const ps = new kakao.maps.services.Places();

                ps.keywordSearch(keyword, (data, status) => {
                    if (status === kakao.maps.services.Status.OK) {
                        const place = data[0];
                        const coords = new kakao.maps.LatLng(place.y, place.x);

                        map.panTo(coords);

                        const marker = new kakao.maps.Marker({
                            position: coords
                        });

                        map.markers && map.markers.forEach(marker => marker.setMap(null));

                        marker.setMap(map);
                        map.markers = [marker];
                        updatePlaceList();
                    }
                });
            };
        }

        function updatePlaceList() {
            const placeListView = document.getElementById('placeListView');
            placeListView.innerHTML = '';

            // 가까운 순으로 정렬
            customMarkers.sort((a, b) => {
                const distanceA = kakao.maps.services.Distance.getDistance(map.getCenter(), a.getPosition());
                const distanceB = kakao.maps.services.Distance.getDistance(map.getCenter(), b.getPosition());
                return distanceA - distanceB;
            });

            customMarkers.forEach(marker => {
                const distance = kakao.maps.services.Distance.getDistance(map.getCenter(), marker.getPosition());
                const listItem = document.createElement('li');
                // 부여한 이름 및 주소 표시
                listItem.textContent = `이름: ${marker.name}, 주소: ${marker.getPosition()} (거리: ${distance.toFixed(2)}m)`;
                placeListView.appendChild(listItem);
            });
        }

        // Kakao Maps API를 로드한 후 initMap 함수를 호출
        kakao.maps.load(() => {
            initMap();
        });
    </script>
</body>

</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kakao Map Example</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=204a7c5835adfe98d1f80dbb2054fab3&libraries=services,clusterer,drawing"></script>
</head>
<body>
    <div id="map" style="width:100%;height:400px;"></div>
    <input type="text" id="searchInput" placeholder="장소를 검색하세요">
    <button onclick="searchPlace()">검색</button>
    <ul id="placeListView"></ul>

    <script>
        function haversine(lat1, lon1, lat2, lon2) {
            const R = 6371; // 지구의 반지름 (단위: km)
            const dLat = (lat2 - lat1) * (Math.PI / 180);
            const dLon = (lon2 - lon1) * (Math.PI / 180);
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c; // 거리 (단위: km)
            return distance;
        }

        function initMap() {
            let map;
            let customMarkers = [];
            const placeListView = document.getElementById('placeListView');

            const container = document.getElementById('map');
            const options = {
                center: new kakao.maps.LatLng(37.5665, 126.9780),
                level: 13
            };

            map = new kakao.maps.Map(container, options);

            // 사용자가 직접 입력한 장소 목록
            const locations = [
                { name: '티스테이션 도림점', address: '서울 영등포구 도림로 342' },
                { name: '장소2', address: '주소2' },
                // 추가적으로 필요한 만큼 계속 추가
            ];

            locations.forEach(location => {
                const address = location.address;
                const name = location.name;

                // 주소로부터 좌표 얻어오기
                const geocoder = new kakao.maps.services.Geocoder();
                geocoder.addressSearch(address, (result, status) => {
                    if (status === kakao.maps.services.Status.OK) {
                        const customCoords = new kakao.maps.LatLng(result[0].y, result[0].x);
                        const customMarker = new kakao.maps.Marker({
                            position: customCoords,
                            map: map,
                        });

                        // 사용자가 부여한 이름 추가
                        customMarker.name = name;

                        customMarkers.push(customMarker);
                        updatePlaceList();
                    }
                });
            });

            const input = document.getElementById('searchInput');

            window.searchPlace = function() {
                const keyword = input.value;
                const ps = new kakao.maps.services.Places();

                ps.keywordSearch(keyword, (data, status) => {
                    if (status === kakao.maps.services.Status.OK) {
                        const place = data[0];
                        const coords = new kakao.maps.LatLng(place.y, place.x);

                        map.panTo(coords);

                        const marker = new kakao.maps.Marker({
                            position: coords
                        });

                        map.markers && map.markers.forEach(marker => marker.setMap(null));

                        marker.setMap(map);
                        map.markers = [marker];
                        updatePlaceList();
                    }
                });
            };
        }

        function updatePlaceList() {
            const placeListView = document.getElementById('placeListView');
            placeListView.innerHTML = '';

            // 가까운 순으로 정렬
            customMarkers.sort((a, b) => {
                const distanceA = haversine(map.getCenter().getLat(), map.getCenter().getLng(), a.getPosition().getLat(), a.getPosition().getLng());
                const distanceB = haversine(map.getCenter().getLat(), map.getCenter().getLng(), b.getPosition().getLat(), b.getPosition().getLng());
                return distanceA - distanceB;
            });

            customMarkers.forEach(marker => {
                const distance = havers
